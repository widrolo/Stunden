let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');
let rows = 9;
let cols = 5;

let buttons = []

// in order with validNames in database.js
let plans = [
//Mina = 
    [1,0,0,5,6,0,8,9,10,12,13,14,0,16,17,0,19,21,22,23,24,25,26,27,28,30,31,32,33,0,35,36,37,39,40,41,42,43,0,0],
//Selver = 
    [1,3,4,0,6,7,8,9,10,12,0,14,15,16,0,0,19,21,22,23,24,0,26,27,28,30,31,32,33,34,35,36,37,0,0,41,42,0,0,0],
//Alex = 
    [1,0,0,0,6,7,8,9,10,12,0,14,15,16,17,18,19,21,22,23,24,25,0,0,28,30,31,32,33,34,35,36,37,39,40,41,42,0,0,0],
//Jill = 
    [1,3,4,0,6,7,8,9,10,12,0,14,15,16,17,18,0,21,22,23,24,25,0,0,28,30,31,32,33,34,35,36,37,39,40,41,42,0,0,0],
//Hamza = 
    [1,0,0,0,6,0,8,9,10,12,0,14,15,16,0,0,19,0,0,23,24,25,26,27,28,30,31,32,33,0,35,36,37,39,40,41,42,43,44,45],
//Eveline = 
    [1,0,0,0,6,7,8,9,10,12,0,14,15,16,17,18,0,21,22,23,24,25,26,27,28,30,31,32,33,0,0,0,37,39,40,41,0,0,0,0],
//Mert = 
    [1,0,0,5,6,7,8,9,10,12,0,14,15,0,0,0,19,21,22,23,24,25,26,27,28,0,0,32,33,0,35,36,37,39,40,41,42,0,0,0],
//Wen = 
    [1,3,4,5,6,0,8,9,10,12,0,14,15,0,0,0,19,0,0,23,24,25,26,27,28,0,0,32,33,34,35,36,37,39,40,41,42,0,0,0],
//Ryan = 
    [1,3,4,0,6,7,8,9,10,12,0,14,15,16,0,0,0,21,22,23,24,0,26,27,28,30,31,32,33,34,35,36,37,0,0,41,42,0,0,0],
//Zarko = 
    [1,0,0,0,6,7,8,9,10,12,0,14,15,16,17,18,0,21,22,23,24,25,26,27,28,30,31,32,33,0,0,0,37,39,40,41,42,0,0,0],
//Rojin = 
    [1,3,4,5,6,0,8,9,10,12,0,14,15,0,17,18,19,0,0,23,24,25,26,27,28,0,0,32,33,34,35,36,37,39,40,41,42,0,0,0],
//Bahar = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Shayma = 
    [1,0,0,0,6,7,8,9,10,12,0,14,15,16,17,18,0,21,22,23,24,25,26,27,28,30,31,32,33,0,0,0,37,39,40,41,42,0,0,0],
//Hacer = 
    [0,1,3,4,0,6,7,8,9,10,12,0,14,15,16,0,0,0,21,22,23,24,25,26,27,28,30,31,32,0,34,35,36,37,39,40,41,42,0,0,0],
//Elman = 
    [1,3,4,5,6,0,8,9,10,12,0,14,15,0,17,18,19,0,0,23,24,25,26,27,28,0,0,32,33,34,35,36,37,39,40,41,42,43,0,0],
//Filip = 
    [1,3,4,0,6,7,8,9,10,12,0,14,15,16,0,0,0,21,22,23,24,0,26,27,28,30,31,32,33,34,35,36,37,0,0,41,42,0,0,0],
//Defne = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Imam = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Ceyda = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Berat = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Aleyna = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Elvira = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Ata = 
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
//Jeremy =
    [1,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45], //Unfertig
]

const StundenplanMix = 
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

let cellWidth = canvas.width/cols;
let cellHeight = canvas.height/rows;
let freeLesson;

init();

function init() {
    for (let i = 0; i < 24; i++){
        buttons[i] = false;
    }

    update();
}


function button(id) {
    let i = validNames.indexOf(id);
    buttons[i] = !buttons[i];

    if (buttons[i]) {
        document.getElementById(id).style.backgroundColor = "green";
    } else {
        document.getElementById(id).style.backgroundColor = "white";
    }
    update();
}

function mix(){

    freeLesson = 0;
    for(let i = 0; i < 40; i++){StundenplanMix[i] = 0}

    for(let i = 0; i < 40; i++){
        for(let j = 0; j < 25; j++){
            if (buttons[j])
                StundenplanMix[i] += plans[j][i];
        }

        if (StundenplanMix[i] == 0){    
            freeLesson++;
            if (i == 0 || i == 8 || i == 16 || i == 24 || i == 32){    
                freeLesson++;
            }
        }
    }
}
function draw() {
    ctx.fillStyle = 'black';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    
    ctx.fillStyle = 'red';

    for (let i = 0; i < 5; i++){
        for (let j = 0; j < 9; j++){
            paint(i, j);
        }
    }
    ctx.fillStyle = 'green';

    for (let i = 0; i < 5; i++){
        fillRows(i);
    }
    requestAnimationFrame(draw);
}

function fillRows(collumn)
{
    for (let j = 0; j < 8; j++){
        if (j == 0) {
            if (StundenplanMix[collumn * 8 + j] == 0){
                paint(collumn, j);
                paint(collumn, j + 1);
            }
            continue;
        }
        if (StundenplanMix[collumn * 8 + j] == 0){
            paint(collumn, j + 1);
        }
    }
}

function paint(x, y) {
    ctx.fillRect(x*cellWidth, y*cellHeight, cellWidth - 1, cellHeight - 1);
}

function update() {
    mix();
    draw();
    document.getElementById("freeLesson").textContent = freeLesson + " gemeinsame Freistunden";
}